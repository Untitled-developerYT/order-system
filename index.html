<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
  
  <meta charset="utf-8" />
  <title>Customer Order</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    
        /* Scanner Overlay Styles */
        #scanner-container {
            position: fixed;
            inset: 0;
            background-color: black;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #video-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #scan-box {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 70vw;
            height: 70vw;
            max-width: 400px;
            max-height: 400px;
            transform: translate(-50%, -50%);
            border: 4px solid rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
        }
        #close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background-color: rgba(255, 255, 255, 0.3);
            color: white;
            font-weight: bold;
            font-size: 24px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            border: none;
            cursor: pointer;
            padding: unset;
        }
        #scanner-status-text {
            position: absolute;
            bottom: 32px;
            color: white;
            background-color: rgba(0, 0, 0, 0.4);
            padding: 8px 16px;
            border-radius: 8px;
        }
        /* This class ensures elements are fully hidden */
        .hidden {
            display: none !important;
        }
    h1 { margin-bottom: 0; }
    #status { margin: 8px 0 16px; padding: 10px; border-radius: 8px; background:#e5e7eb; }
    .ok { background:#d1fae5; color:#065f46; }
    .err { background:#fee2e2; color:#991b1b; }
    input, textarea { width:100%; padding:10px; box-sizing:border-box; border:1px solid #d1d5db; border-radius:8px; }
    #orders { margin-top:20px; }
    #orders li { background:#fff; padding:8px; margin:6px 0; border-radius:8px; border:1px solid #e5e7eb; }
    #qrcode {
    /* QR code will be generated inside this div */
    display: flex; /* To center the canvas/img generated by qrcode.js */
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Hide anything that spills out if sizing is off */
    padding: 10px; /* Padding inside the QR code container */

  }
  
    /* Popup */
    #popup {
      display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6);
      align-items:center; justify-content:center; padding:20px; z-index:100;
    }
    #popup .card {
      background:#fff; max-width:800px; width:100%; padding:20px;
      border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.3);
    }
    #popup textarea { height:120px; }




body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f4f9;
    margin: 0;
    padding: 20px;
}
.container { max-width: 800px; margin: auto; }
h2 { text-align: center; color: #333; margin-bottom: 30px; }

/* Form card */
form {
    background: #FED8B1;
    padding: 25px 30px;
    margin-bottom: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
}

/* Form title */
form h3 {
    margin-top: 0;
    color: #333;
    font-size: 1.5em;
    margin-bottom: 20px;
}

/* Question title */
p.question-title {
    font-weight: 600;
    margin-bottom: 12px;
    color: #222;
    font-size: 1.1em;
}

/* MC option labels as buttons */
label.mc-option {
    display: block;
    margin-bottom: 12px;
    cursor: pointer;
    font-size: 1em;
    user-select: none;
}
label.mc-option span {
    display: block;
    padding: 14px 18px;
    border-radius: 8px;
    background-color: #e0e0e0; /* grey background */
    transition: background 0.2s, color 0.2s;
}
label.mc-option:hover span {
    background-color: #d5d5d5;
}
input[type="radio"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
    margin: 0;
    padding: 0;
}
input[type="radio"]:checked + span {
    background-color: #4285f4; /* selected color */
    color: white;
}

/* Text and textarea inputs */
input[type="text"], textarea {
    width: 100%;
    padding: 16px;
    margin-bottom: 20px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 18px;
    box-sizing: border-box;
}
textarea { display: flex; }

/* Submit button */
button {
    background-color: #4285f4;
    color: white;
    border: none;
    padding: 18px 25px;
    font-size: 20px;
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
    width: 100%;
    box-sizing: border-box;
}
button:hover {
    background-color: #3367d6;
    transform: translateY(-1px);
}

/* Top banners */
.topBanner {
    display:none;
    position: fixed;
    top:10px;
    left:50%;
    transform: translateX(-50%);
    padding: 15px 25px;
    border-radius: 8px;
    font-size: 16px;
    z-index: 9999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    text-align: center;
    transition: opacity 0.3s;
    color: white;
}
#confirmationBanner { background-color: #34a853; }
#incompleteBanner { background-color: #ea4335; }

/* Responsive */
@media (max-width: 600px) {
    form { padding: 20px; }
    input[type="text"], textarea, button { font-size: 18px; padding: 14px; }
    p.question-title { font-size: 1.05em; }
    label.mc-option span { padding: 16px 18px; font-size: 16px; }
}
/*-------------------------------------------------modal stuf-------------------------------------------------*/
.modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8); /* Darken background for full-screen effect */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            width: 100%;
            height: 100%;
            padding: 1.5rem;
            position: relative;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        /* New styling for the normal exit button */
        
        /* Styles for the carousel */
        .carousel-container {
            position: relative;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1;
            justify-content: center;
        }
        .carousel-slides {
            display: flex;
            transition: transform 0.5s ease-in-out;
            width: 100%;
            height: 100%;
        }
        .carousel-slide {
            min-width: 100%;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .qrcode-wrapper {
            width: 80%;
            max-width: 300px;
            aspect-ratio: 1; /* Keep a 1:1 aspect ratio */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* New: Styles for horizontally scrollable navigation */
        
        
        
        /* Desktop/larger screens adjustments */
        @media (min-width: 768px) {
            .modal-content {
                width: 90%;
                max-width: 500px;
                height: auto;
                border-radius: 12px;
                padding: 2rem;
            }
        }
  </style>
</head>
<body>
    <h1>Customer Ordering</h1>
    <div id="status">
        Not connected
    </div>
    <button id="reconnectBtn" style="float:right; background-color: #f0f0f0; color: #333; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">Reconnect</button>
    <div id="orderArea" style="display:none;">
        <input id="orderInput" placeholder='e.g. "Customer ordered extra peas"' />
        <button id="sendBtn">Send Order</button>
        <ul id="orders"></ul>
    </div>
    <div id="confirmationBanner" class="topBanner">Form submitted successfully!</div>
    <div id="incompleteBanner" class="topBanner">Please complete all required questions!</div>

    <div class="container">
        <h2>Available Forms</h2>
        <div id="formsContainer"></div>
    </div>
  <!-- Setup Popup -->
    <div id="popup">
        <div class="card">
            <h2>Connection Setup</h2>
            <p>Step 1: Copy this OFFER and give it to the Kitchen:</p>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <textarea id="offerOutput" readonly></textarea>
                <div><div id="qrcode" ></div></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <button id="copyOfferBtn">Copy Offer</button>
                <button id="generateQRCodeBtn">Generate QR Code</button>
            </div>
      
            <p>Step 2: Paste the ANSWER from Kitchen here:</p>
            <textarea id="answerBox" placeholder="Paste ANSWER here"></textarea>
            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <button id="scan-btn">Scan QR Code</button>
                <button id="reset-btn">Reset Scanner</button>
                <button id="applyAnswerBtn">Apply Answer</button>
            </div>
            <p><button id="closePopupBtn">Close Setup</button></p>
        </div>
    </div>
<!-- end of setup-->
    <div id="scanner-container" class="hidden">
        <div id="video-container">
            <video id="video" playsinline></video>
            <div id="scan-box"></div>
        </div>
        <canvas id="canvas" class="hidden"></canvas>
        <button id="close-btn">&times;</button>
        <p id="scanner-status-text">Point camera at a QR code</p>
    </div>
    <div id="qr-modal" class="modal">
        <div class="modal-content">
            <div class="carousel-container">
                <div id="carousel-slides" class="carousel-slides">
                    <!-- QR codes will be dynamically added here -->
                </div>
            </div>
            <div id="carousel-nav">
                <button id="prev-btn">Previous</button>
                <button id="next-btn">Next</button>
            </div>
            <button class="close-btn">Exit</button>
        </div>
    </div>
    <script>
        // reconect to the kitchen
        document.getElementById("reconnectBtn").onclick = () => {
            if (!pc) {
                console.log("No PeerConnection, please redo setup.");
                return;
            }
            if (!channel || channel.readyState !== "open") {
                channel = pc.createDataChannel("orders");
                channel.onopen = () => document.getElementById("status").innerText = "Reconnected ✅";
                channel.onclose = () => document.getElementById("status").innerText = "Disconnected ❌";
            }
        };






        // Helpers
        let jsonForms
        const encode = obj => btoa(unescape(encodeURIComponent(JSON.stringify(obj))));
        const decode = str => JSON.parse(decodeURIComponent(escape(atob(str))));
        function waitForIceComplete(pc) {
            return new Promise(resolve => {
                if (pc.iceGatheringState === 'complete') return resolve();
                pc.addEventListener('icegatheringstatechange', function check() {
                    if (pc.iceGatheringState === 'complete') {
                        pc.removeEventListener('icegatheringstatechange', check);
                        resolve();
                    }
                });
            });
        }
        function setStatus(msg, cls="") {
            const el = document.getElementById("status");
            el.className = cls;
            el.textContent = msg;
        }

        // WebRTC setup
        let pc = new RTCPeerConnection();
        let channel = pc.createDataChannel("orders");

        channel.onopen = () => {
            setStatus("Connected ✅ Ready to send orders", "ok");
            document.getElementById("orderArea").style.display = "block";
        };
        channel.onclose = () => setStatus("Disconnected ❌", "err");

        pc.onconnectionstatechange = () => {
            if (pc.connectionState === "failed") setStatus("Connection failed ❌", "err");
        };

        // Send order
        document.getElementById("sendBtn").onclick = () => {
            let msg = document.getElementById("orderInput").value.trim();
            if (!msg) return;
            channel.send(msg);
            document.getElementById("orders").appendChild(li);
            document.getElementById("orderInput").value = "";
        };

        // Setup popup
        const popup = document.getElementById("popup");
        document.getElementById("closePopupBtn").onclick = () => popup.style.display="none";

        async function initOffer() {
            setStatus("Creating offer…");
            const offer = await pc.createOffer();
            await pc.setLocalDescription(offer);
            await waitForIceComplete(pc);
            document.getElementById("offerOutput").value = encode(pc.localDescription);
            popup.style.display = "flex";
            setStatus("Share the OFFER with Kitchen, then paste their Answer.");
        }

        document.getElementById("copyOfferBtn").onclick = () => {
            document.getElementById("offerOutput").select();
            document.execCommand("copy");
            setStatus("Offer copied ✅ Share it with Kitchen", "ok");
        };

        document.getElementById("applyAnswerBtn").onclick = async () => {
            try {
                const txt = document.getElementById("answerBox").value.trim();
                if (!txt) return;
                const answer = decode(txt);
                await pc.setRemoteDescription(answer);
                localStorage.setItem("kitchenAnswer", txt); // save for future
                setStatus("Answer applied, connecting…");
                popup.style.display = "none";
            } catch(e) {
                setStatus("Invalid Answer ❌", "err");
            }
        };

        // Auto-load saved Answer if available
        initOffer();
        channel.onmessage = e => {
            jsonForms = e.data
            loadForms();
        };
        //this new thing
        function loadForms() {
            const container = document.getElementById('formsContainer');
            container.innerHTML = '';
            console.log(jsonForms);
            const forms = JSON.parse(jsonForms || '[]');
            if(forms.length === 0) {
                container.innerHTML = '<p>No forms available.</p>';
                return;
            }

            forms.forEach((form, idx) => {
                const formEl = document.createElement('form');
                formEl.id = `form_${idx}`;
                formEl.innerHTML = `<h3>${form.title}</h3>`;

                form.questions.forEach(q => {
                    let qHtml = '';
                    if(q.type === 'text') {
                        qHtml = `<p class="question-title">${q.text}</p><input type="text" id="${q.id}" required>`;
                    } else if(q.type === 'textarea') {
                        qHtml = `<p class="question-title">${q.text}</p><textarea id="${q.id}" rows="4" required></textarea>`;
                    } else if(q.type === 'mc') {
                        qHtml = `<p class="question-title">${q.text}</p>`;
                        q.options.forEach((o, index) => {
                            const requiredAttr = index===0?'required':'';
                            qHtml += `<label class="mc-option"><input type="radio" name="${q.id}" value="${o}" ${requiredAttr}><span>${o}</span></label>`;
                        });
                    }
                    formEl.innerHTML += qHtml;
                });

                formEl.innerHTML += `<button type="button" onclick="submitForm(${idx})">Submit</button>`;
                container.appendChild(formEl);
            });
        }

        function submitForm(idx) {
            const formEl = document.getElementById(`form_${idx}`);

            // Custom validation
            const requiredInputs = formEl.querySelectorAll('input[required], textarea[required]');
            let allValid = true;
            requiredInputs.forEach(input => {
                if(input.type==='radio') {
                    const checked = formEl.querySelector(`input[name="${input.name}"]:checked`);
                    if(!checked) allValid = false;
                } else if(!input.value.trim()) allValid = false;
            });

            if(!allValid) {
                showBanner('incompleteBanner');
                return;
            }

            // Collect answers
            const answerJSON = {};
            const forms = JSON.parse(jsonForms || '[]');
            const currentForm = forms[idx];

            currentForm.questions.forEach(q=>{
                const el = document.getElementById(q.id) || formEl.querySelector(`input[name="${q.id}"]:checked`);
                if(!el) return;
                const value = (el.type==='radio') ? el.value : el.value;
                answerJSON[q.text] = value;
            });
            channel.send(JSON.stringify(answerJSON, null, 2))
            console.log("Form submission JSON:", JSON.stringify(answerJSON, null, 2));
            formEl.reset();
            showBanner('confirmationBanner');
        }

        function showBanner(id){
            const banner = document.getElementById(id);
            banner.style.display='block';
            banner.style.opacity='1';
            setTimeout(()=>{
                banner.style.opacity='0';
                setTimeout(()=>banner.style.display='none',300);
            },3000);
        }





        // QR Code Modal Logic
        const generateBtn = document.getElementById('generateQRCodeBtn');
        const textInput = document.getElementById('offerOutput');
        
        // Modal elements
        const qrModal = document.getElementById('qr-modal');
        const closeBtn = document.querySelector('.close-btn');
        const carouselSlides = document.getElementById('carousel-slides');
        const carouselNav = document.getElementById('carousel-nav');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        let currentSlide = 0;
        let qrData = [];

        /**
         * Splits a string into a specified number of approximately equal parts.
         * @param {string} str The string to split.
         * @param {number} parts The number of parts to split the string into.
         * @returns {string[]} An array containing the parts of the string.
         */
        function splitStringIntoNParts(str, parts) {
            const result = [];
            if (parts <= 0) return result;
            const chunkSize = Math.ceil(str.length / parts);
            for (let i = 0; i < str.length; i += chunkSize) {
                result.push(str.slice(i, i + chunkSize));
            }
            return result;
        }

        /**
         * Updates the active state of the navigation buttons.
         */
        

        /**
         * Moves the carousel to a specific slide.
         * @param {number} slideIndex The index of the slide to show.
         */
        function showSlide(slideIndex) {
            currentSlide = slideIndex;
            carouselSlides.style.transform = `translateX(-${currentSlide * 100}%)`;
        }

        /**
         * Generates and displays the QR codes in the carousel.
         * @param {string} text The string to generate QR codes from.
         */
        function generateQRCodeAndShowPopup(text) {
            const splitCount = parseInt(10, 10);
            
            if (!text || text.trim() === '') {
                carouselSlides.innerHTML = '<p style="color:#dc3545; text-align:center;">Please provide some text.</p>';
                carouselNav.innerHTML = '';
                qrModal.style.display = 'flex';
                return;
            }

            if (isNaN(splitCount) || splitCount < 1 || splitCount > 10) {
                carouselSlides.innerHTML = '<p style="color:#dc3545; text-align:center;">Please enter a valid number of QR codes (1-10).</p>';
                carouselNav.innerHTML = '';
                qrModal.style.display = 'flex';
                return;
            }

            // Clear previous content
            carouselSlides.innerHTML = '';
            
            currentSlide = 0;
            qrData = splitStringIntoNParts(text, splitCount);

            // Dynamically create slides and QR codes for each half
            qrData.forEach((part, index) => {
                const slideDiv = document.createElement('div');
                slideDiv.className = 'carousel-slide';

                const titleP = document.createElement('p');
                titleP.textContent = `QR Code ${index + 1} of ${qrData.length}`;
                titleP.style.fontSize = '1.2rem';
                titleP.style.fontWeight = 'bold';
                slideDiv.appendChild(titleP);

                // Create a responsive wrapper for the QR code
                const qrcodeWrapper = document.createElement('div');
                qrcodeWrapper.className = 'qrcode-wrapper';
                slideDiv.appendChild(qrcodeWrapper);

                carouselSlides.appendChild(slideDiv);

                // Generate the QR code within the wrapper
                new QRCode(qrcodeWrapper, {
                    text: part,
                    width: 200,
                    height: 200,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.H
                });
            });

            // Create numbered navigation buttons
            

            // Show the modal and set initial state
            qrModal.style.display = 'flex';
            showSlide(0); // Show the first slide by default
        }

        /**
         * Hides the popup modal.
         */
        function hideModal() {
            qrModal.style.display = 'none';
        }

        // Add event listeners
        closeBtn.addEventListener('click', hideModal);
        prevBtn.addEventListener('click', () => {
            let newIndex = currentSlide - 1;
            if (newIndex < 0) {
                newIndex = qrData.length - 1; // Wrap around to the last slide
            }
            showSlide(newIndex);
        });

        nextBtn.addEventListener('click', () => {
            let newIndex = currentSlide + 1;
            if (newIndex >= qrData.length) {
                newIndex = 0; // Wrap around to the first slide
            }
            showSlide(newIndex);
        });
        // Hide the modal when clicking outside of it
        window.addEventListener('click', (event) => {
            if (event.target === qrModal) {
                hideModal();
            }
        });

        // Event listener to call the new function when the button is clicked
        generateBtn.addEventListener('click', () => {
            generateQRCodeAndShowPopup(textInput.value);
        });
        // new scanner logic------------------------------------------------------------
        // --- CONFIGURATION ---
        const NUM_PARTS = 10; // <<<<<<<<<<<<<<< CONFIGURE THE NUMBER OF PARTS HERE
        // -------------------

        let scannedData = new Array(NUM_PARTS).fill(null);
        let currentPartToScanIndex = 0; // 0-indexed

        const scanBtn = document.getElementById('scan-btn');
        const resetBtn = document.getElementById('reset-btn');
        const scanCloseBtn = document.getElementById('close-btn');
        const scannerContainer = document.getElementById('scanner-container');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const scannerStatusText = document.getElementById('scanner-status-text');
        
        const resultText = document.getElementById('answerBox');
        

        let stream;

        // Initialize UI on load
        document.addEventListener('DOMContentLoaded', () => {            
            resetScanner();
        });

        scanBtn.addEventListener('click', startScanner);
        resetBtn.addEventListener('click', resetScanner);
        scanCloseBtn.addEventListener('click', stopScanner);
        
        

        function resetScanner() {
            scannedData.fill(null);
            currentPartToScanIndex = 0;
            combinedData = null;

            for (let i = 0; i < NUM_PARTS; i++) {
                updateStatusUI(i + 1, 'Awaiting scan...', false);
            }
            
            scanBtn.textContent = `Start Scanning (Part ${currentPartToScanIndex + 1})`;
            scanBtn.disabled = false;
            
            
        }

        async function startScanner() {
            scannerContainer.classList.remove('hidden');
            scannerStatusText.textContent = `Point camera at QR Code for Part ${currentPartToScanIndex + 1}`;

            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                video.srcObject = stream;
                video.setAttribute("playsinline", true);
                video.play();
                requestAnimationFrame(tick);
            } catch (err) {
                console.error("Camera Error:", err);
                stopScanner();
                scannerStatusText.textContent = "Error: Could not access camera.";
            }
        }

        function stopScanner() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            scannerContainer.classList.add('hidden');
        }

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvas.height = video.videoHeight;
                canvas.width = video.videoWidth;
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height, { inversionAttempts: "dontInvert" });

                if (code) {
                    handleQRCode(code.data);
                } else {
                    requestAnimationFrame(tick);
                }
            } else {
                requestAnimationFrame(tick);
            }
        }

        function handleQRCode(data) {
            // Check if this part has already been scanned to prevent rescanning the same part immediately
            if (scannedData[currentPartToScanIndex] === data) {
                 requestAnimationFrame(tick); // Keep scanning if it's the same data
                 return;
            }

            stopScanner(); // Stop scanner after every new successful scan

            scannedData[currentPartToScanIndex] = data;
            updateStatusUI(currentPartToScanIndex + 1, `Part ${currentPartToScanIndex + 1} Scanned!`, true);
            console.log(`Part ${currentPartToScanIndex + 1} Scanned:`, data);
            
            currentPartToScanIndex++;

            if (currentPartToScanIndex < NUM_PARTS) {
                // Not all parts scanned yet, prepare for next scan
                scanBtn.textContent = `Scan Part ${currentPartToScanIndex + 1}`;
                scanBtn.disabled = false;
                resetBtn.classList.add('hidden'); // Keep reset hidden until all parts are done
            } else {
                // All parts scanned
                combineAndShowResult();
            }
        }

        function combineAndShowResult() {
            combinedData = scannedData.join(''); // Joins all scanned data strings
            
            console.log("Combined Data:", combinedData);
            resultText.textContent = combinedData;
            
            
            scanBtn.textContent = 'All Parts Scanned!';
            scanBtn.disabled = true;
            resetBtn.classList.remove('hidden');
        }

        function updateStatusUI(partNumber, text, isSuccess) {
            const statusEl = document.getElementById(`part${partNumber}-status`);
            if (!statusEl) return; // Guard against non-existent elements

            const iconEl = statusEl.querySelector('.status-icon');
            const textEl = statusEl.querySelector('.status-text');

            textEl.textContent = text;
            if (isSuccess) {
                statusEl.classList.add('success');
                iconEl.innerHTML = '&#10003;'; // Checkmark
            } else {
                statusEl.classList.remove('success');
                iconEl.textContent = partNumber;
            }
        }
    </script>
</body>
</html>
